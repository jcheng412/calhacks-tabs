<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">

    <meta http-equiv="Content-Security-Policy"
    content="default-src *; img-src https://*; child-src 'none'; script-src *;">

    <title></title>
    <link href="https://fonts.googleapis.com/css?family=Merriweather|Open+Sans" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="popup.css">
    <script src="https://s3.amazonaws.com/stitch-sdks/js/bundles/4.0.8/stitch.js"></script>
  </head>
  <body>
    <div class="title" >Welcome to<br /> Guppy</div>

    <form class="login">
      <input id= "usernameIn" class="textIn" type="text" placeholder="Username" name="username"/><br />
      <input id= "passwordIn" class="textIn" type="text" placeholder="Password" name="password" /> <br />
      <input id="submitLogin" class="submit" type="submit" value="Login"/>
    </form>
    <br>Don't have an account? <a href="register.html">Sign up!</a>

    <script>
      const client = stitch.Stitch.initializeDefaultAppClient('bookmarks-hlhev');

      document.getElementById("submitLogin").addEventListener("click", function(event){
        event.preventDefault();
        console.log("Start Login validation");

        //make a credential variable that has the inputed user
        let username = document.getElementById("usernameIn").value;
        let password = document.getElementById("passwordIn").value;

        //set session variables
        sessionStorage.setItem('username', username);

        // console.log (username, password);
        const credential = new stitch.UserPasswordCredential(username, password);

        client.auth.loginWithCredential(credential).then(authedId => {
           console.log(`successfully logged in with id: ${authedId}`)
           //route to the home page
           console.log("login sucess!!");
           console.log(sessionStorage.getItem('username'));
        }).catch(err => console.error(`login failed with error: ${err}`))
      });


    </script>
  </body>
</html>
